{"version":3,"sources":["server/socketHandler/story/request-trip.js"],"names":["watchIdObj","promObj","getConfig","resolve","reject","findOneAsync","key","then","foundDetails","value","catch","err","requestTripHandler","socket","on","quantum","riderID","payload","rider","_id","nearByDriver","i","nearByDriversDoc","length","checkSocketConnection","removeDriverFromList","roundRobinAsync","result","console","log","tripRequest","tripRequestStatus","emitByUserId","e","clearInterval","driverId","driver","findOneAndUpdateAsync","$set","new","updatedTripRequestObject","updateAsync","$or","riderId","currTripId","currTripState","multi","error","message","data","userId","toString","updatedTripRequestObj","count","remain","prom","dispatchHandlerAsync","nearByDrivers","promise","sendRequestAsync","response","dispatchDriverAsync","email","rideAcceptRider","sms","resetTripRequestAsync","setTimeout","timeout","def","fname","createTripRequestObjAsync","tripRequestObj","setInterval","drivers","index","slice","concat","srcLocation","srcLoc","destLocation","destLoc","pickUpAdrs","pickUpAddress","destAdrs","destAddress","latDelta","latitudeDelta","lonDelta","longitudeDelta","paymentMode","driverID","boosterSeatNum","tripId","saveAsync","savedTripRequest","returnObj","driverObj","id","res","getByUserId","success","userType","userDoc","findAsync","$and","gpsLoc","$geoWithin","$center","radius","loginStatus","driverDoc","INTERNAL_SERVER_ERROR","driverErr"],"mappings":"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","file":"request-trip.js","sourceRoot":"../../../../../../.."}