{"version":3,"sources":["server/socketHandler/story/start-trip.js"],"names":["getConfig","Promise","resolve","reject","findOneAsync","key","then","foundDetails","value","catch","err","startTripHandler","socket","on","tripRequestObj","cb","console","log","riderID","riderId","driverID","driverId","tripRequestStatus","tripObj","srcLoc","destLoc","pickUpAddress","destAddress","paymentMode","saveAsync","savedTrip","tripId","_id","findOneAndUpdateAsync","$set","error","e","emitByUserId","updateAsync","$or","currTripId","currTripState","new","multi","returnObj","message","data","tripStatus","riderRatingByDriver","driverRatingByRider","bookingTime","now","Date","travelTime","duration","diff","Math","abs","email","onEndTripRider","onEndTripDriver","sms","updateUserRating","cardPayment","status","paymentStatus","updatedTripObject","updatedTripObj","aggregateAsync","$match","$gt","$group","userRt","$avg","res","length","userRating","toFixed","driverReviewByRider"],"mappings":"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","file":"start-trip.js","sourceRoot":"../../../../../../.."}