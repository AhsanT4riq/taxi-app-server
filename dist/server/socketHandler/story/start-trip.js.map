{"version":3,"sources":["server/socketHandler/story/start-trip.js"],"names":["getConfig","Promise","resolve","reject","AppConfig","findOneAsync","key","then","foundDetails","value","catch","err","startTripHandler","socket","on","tripRequestObj","cb","console","log","riderID","riderId","driverID","driverId","tripRequestStatus","tripObj","TripSchema","srcLoc","destLoc","pickUpAddress","destAddress","paymentMode","saveAsync","savedTrip","tripId","_id","TripRequest","findOneAndUpdateAsync","$set","error","e","SocketStore","emitByUserId","UserSchema","updateAsync","$or","currTripId","currTripState","new","multi","returnObj","message","data","tripStatus","riderRatingByDriver","driverRatingByRider","bookingTime","now","Date","travelTime","moment","duration","diff","Math","abs","email","onEndTripRider","onEndTripDriver","sms","updateUserRating","paymentCtrl","cardPayment","status","paymentStatus","updatedTripObject","updatedTripObj","aggregateAsync","$match","$gt","$group","userRt","$avg","res","length","userRating","toFixed","driverReviewByRider"],"mappings":"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","file":"start-trip.js","sourceRoot":"../../../../../../.."}